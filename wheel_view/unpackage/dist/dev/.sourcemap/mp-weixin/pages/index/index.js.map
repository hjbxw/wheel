{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../software/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"wheel-wrapper\">\r\n\t\t\t<!-- Canvas ËΩ¨Áõò -->\r\n\t\t\t<canvas canvas-id=\"wheelCanvas\" class=\"wheel-canvas\"\r\n\t\t\t\t:style=\"{ width: canvasPixelSize + 'px', height: canvasPixelSize + 'px' }\"></canvas>\r\n\r\n\t\t\t<!-- ÊåáÈíàÔºàÂõ∫ÂÆöÂú®È°∂ÈÉ®ÔºåÊåáÂêëËΩ¨Áõò‰∏≠ÂøÉ‰∏äÊñπÔºâ -->\r\n\t\t\t<view class=\"pointer\"></view>\r\n\t\t</view>\r\n\r\n\t\t<!-- ÂºÄÂßãÊäΩÂ•ñÊåâÈíÆ -->\r\n\t\t<button @click=\"startSpin\" :disabled=\"isSpinning\" class=\"spin-button\">\r\n\t\t\t{{ isSpinning ? 'ËΩ¨Âä®‰∏≠...' : 'ÂºÄÂßãËΩ¨Âä®' }}\r\n\t\t</button>\r\n\r\n\t\t<!-- ‰∏≠Â•ñÁªìÊûúÊòæÁ§∫ -->\r\n\t\t<view v-if=\"resultText\" class=\"result\">{{ resultText }}</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t// üéØ Â•ñÂìÅÂàóË°®ÔºàÂèØËá™ÂÆö‰πâÔºâ\r\n\t\t\t\tprizes: [],\r\n\r\n\t\t\t\t// üé® ÊØè‰∏™ÊâáÂΩ¢ÁöÑÈ¢úËâ≤ÔºàÂæ™ÁéØ‰ΩøÁî®Ôºâ\r\n\t\t\t\tcolors: [],\r\n\r\n\t\t\t\t// üìê Canvas Áõ∏ÂÖ≥\r\n\t\t\t\tcanvasPixelSize: 300, // Canvas ÂÆΩÈ´òÔºàÂÉèÁ¥†Ôºâ\r\n\t\t\t\tctx: null, // Canvas ÁªòÂõæ‰∏ä‰∏ãÊñá\r\n\t\t\t\ttotalRotation: 0, // ÂΩìÂâçÁ¥ØÁßØÊóãËΩ¨ËßíÂ∫¶ÔºàÁî®‰∫éÊéßÂà∂ËΩ¨ÁõòËßÜËßâÊóãËΩ¨Ôºâ\r\n\t\t\t\tisSpinning: false, // ÊòØÂê¶Ê≠£Âú®ÊóãËΩ¨\r\n\t\t\t\tanimationId: null, // requestAnimationFrame ID\r\n\r\n\t\t\t\t//ÁªìÊûúÊñáÊú¨\r\n\t\t\t\tresultText: '',\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tmounted() {\r\n\t\t\tthis.loadWheelConfig();\r\n\t\t\t// È°µÈù¢Âä†ËΩΩÂêéÂàùÂßãÂåñ Canvas Âπ∂ÁªòÂà∂ËΩ¨Áõò\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.initCanvas();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tbeforeDestroy() {\r\n\t\t\t// ÁªÑ‰ª∂ÈîÄÊØÅÂâçÊ∏ÖÈô§Âä®Áîª\r\n\t\t\tif (this.animationId) {\r\n\t\t\t\tcancelAnimationFrame(this.animationId);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmethods: {\r\n\t\t\tasync loadWheelConfig() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst res = await uni.request({\r\n\t\t\t\t\t\turl: 'http://localhost:8080/api/wheel/getPrize',\r\n\t\t\t\t\t\tmethod: 'GET'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\tif (res.statusCode === 200 && res.data) {\r\n\t\t\t\t\t\tconst prize = res.data;\r\n\t\t\t\t\t\tthis.prizes = prize.map(item => item.name);\r\n\t\t\t\t\t\tthis.colors = prize.map(item => item.color);\r\n\t\t\t\t\t\tconsole.log(this.prizes)\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•', e);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: 'Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// üõ† ÂàùÂßãÂåñ CanvasÔºåËé∑ÂèñÁªòÂõæ‰∏ä‰∏ãÊñáÂπ∂ÁªòÂà∂ËΩ¨Áõò\r\n\t\t\tinitCanvas() {\r\n\t\t\t\tthis.ctx = uni.createCanvasContext('wheelCanvas', this);\r\n\t\t\t\tthis.drawWheel();\r\n\t\t\t},\r\n\r\n\t\t\t// üé® ÁªòÂà∂ËΩ¨ÁõòÔºöÊâáÂΩ¢ + ÊñáÂ≠ó\r\n\t\t\tdrawWheel() {\r\n\t\t\t\tif (!this.ctx) return;\r\n\t\t\t\tconst centerX = this.canvasPixelSize / 2;\r\n\t\t\t\tconst centerY = this.canvasPixelSize / 2;\r\n\t\t\t\tconst radius = this.canvasPixelSize / 2 - 15; // ÁïôÂá∫Á©∫Èó¥ÈÅøÂÖçÊñáÂ≠óÊ∫¢Âá∫\r\n\t\t\t\tconst prizeCount = this.prizes.length;\r\n\t\t\t\tconsole.log(this.prizes)\r\n\t\t\t\tconst anglePerPrize = (2 * Math.PI) / prizeCount;\r\n\r\n\t\t\t\t// Ê∏ÖÁ©∫ÁîªÂ∏É\r\n\t\t\t\t//this.ctx.clearRect(0, 0, this.canvasPixelSize, this.canvasPixelSize);\r\n\t\t\t\tfor (let i = 0; i < prizeCount; i++) {\r\n\t\t\t\t\tconst baseOffset = -Math.PI / 2; // üéØ ÂÅèÁßª -90¬∞ÔºåËÆ©ÊâáÂΩ¢ 0¬∞ ÊåáÂêë 12 ÁÇπÈíüÔºàÊåáÈíàÊñπÂêëÔºâ\r\n\r\n\t\t\t\t\tconst startAngle = (i * anglePerPrize + this.totalRotation * Math.PI / 180) + baseOffset;\r\n\t\t\t\t\tconst endAngle = startAngle + anglePerPrize;\r\n\r\n\t\t\t\t\t// 1. ÁªòÂà∂ÊâáÂΩ¢\r\n\t\t\t\t\tthis.ctx.beginPath();\r\n\t\t\t\t\tthis.ctx.moveTo(centerX, centerY);\r\n\t\t\t\t\tthis.ctx.arc(centerX, centerY, radius, startAngle, endAngle);\r\n\t\t\t\t\tthis.ctx.closePath();\r\n\r\n\t\t\t\t\tthis.ctx.fillStyle = this.colors[i % this.colors.length];\r\n\t\t\t\t\tthis.ctx.fill();\r\n\r\n\t\t\t\t\t// 2. ÁªòÂà∂ÊñáÂ≠óÔºàÂ¶Ç‚ÄúÈ±ºÈ¶ôËÇâ‰∏ù‚ÄùÔºâ\r\n\t\t\t\t\tthis.ctx.save();\r\n\t\t\t\t\tthis.ctx.translate(centerX, centerY);\r\n\t\t\t\t\tthis.ctx.rotate(startAngle + anglePerPrize / 2);\r\n\t\t\t\t\tthis.ctx.textAlign = 'center';\r\n\t\t\t\t\tthis.ctx.fillStyle = '#ffffff';\r\n\t\t\t\t\tthis.ctx.font = '20px sans-serif';\r\n\t\t\t\t\tthis.ctx.fillText(this.prizes[i], radius * 0.7, 4);\r\n\t\t\t\t\tthis.ctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\t// ÂøÖÈ°ªË∞ÉÁî® draw() Êâç‰ºöÂ∞ÜÂÜÖÂÆπÊ∏≤ÊüìÂà∞ÁîªÂ∏É‰∏äÔºÅ\r\n\t\t\t\tthis.ctx.draw();\r\n\t\t\t},\r\n\r\n\t\t\t// üéØ ÂºÄÂßãËΩ¨ÁõòÊóãËΩ¨\r\n\t\t\tstartSpin() {\r\n\t\t\t\tif (this.isSpinning) return;\r\n\r\n\t\t\t\tthis.isSpinning = true;\r\n\t\t\t\tthis.resultText = '';\r\n\r\n\t\t\t\tconst prizeCount = this.prizes.length;\r\n\t\t\t\tconst anglePerPrize = 360 / prizeCount;\r\n\r\n\t\t\t\t// ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™\r\n\t\t\t\tconst selectedIndex = Math.floor(Math.random() * prizeCount);\r\n\t\t\t\tconst targetAngle = selectedIndex * anglePerPrize + anglePerPrize / 2;\r\n\r\n\t\t\t\t// ÊÄªÂÖ±ËΩ¨ N Âúà + ÁõÆÊ†áËßíÂ∫¶ÁöÑÂèçÊñπÂêëÔºàÂõ†‰∏∫ÊåáÈíàÂõ∫ÂÆöÂú®È°∂ÈÉ®Ôºâ\r\n\t\t\t\tconst spins = 1; // ËΩ¨ 5 Âúà\r\n\t\t\t\tconst finalAngle = spins * 360 + (360 - targetAngle);\r\n\t\t\t\t// ÊâßË°åÊóãËΩ¨Âä®Áîª\r\n\t\t\t\tthis.doRotationAnimation(finalAngle, () => {\r\n\t\t\t\t\t// Âä®ÁîªÁªìÊùüÂêéÊòæÁ§∫‰∏≠Â•ñ\r\n\t\t\t\t\tthis.resultText = `üòÄ‰ªäÂ§©‰∏≠ÂçàÂêÉÔºö${this.prizes[selectedIndex]}`;\r\n\t\t\t\t\tthis.isSpinning = false;\r\n\t\t\t\t});\r\n\r\n\t\t\t},\r\n\r\n\t\t\t// üåÄ ÊâßË°åÊóãËΩ¨Âä®ÁîªÔºà‰ΩøÁî® requestAnimationFrameÔºâ\r\n\t\t\tdoRotationAnimation(targetTotalAngle, onFinish) {\r\n\t\t\t\tlet current = 0;\r\n\t\t\t\tconst totalTarget = targetTotalAngle;\r\n\t\t\t\tconst duration = 4000; // Âä®ÁîªÊó∂Èïø 4 Áßí\r\n\t\t\t\tconst startTime = Date.now();\r\n\r\n\t\t\t\tconst step = () => {\r\n\t\t\t\t\tconst elapsed = Date.now() - startTime;\r\n\t\t\t\t\tlet progress = Math.min(elapsed / duration, 1);\r\n\r\n\t\t\t\t\t// ÁºìÂä®ÂáΩÊï∞ÔºöÂÖàÂø´ÂêéÊÖ¢\r\n\t\t\t\t\tprogress = 1 - Math.pow(1 - progress, 3); // easeOut cubic\r\n\r\n\t\t\t\t\tconst currentAngle = totalTarget * progress;\r\n\t\t\t\t\tthis.totalRotation = currentAngle;\r\n\r\n\t\t\t\t\t// ÈáçÁªòËΩ¨ÁõòÔºàÊóãËΩ¨ÂêéÊïàÊûúÔºâ\r\n\t\t\t\t\tthis.drawWheel();\r\n\r\n\t\t\t\t\tif (progress < 1) {\r\n\t\t\t\t\t\tthis.animationId = requestAnimationFrame(step);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.totalRotation = totalTarget; // Á°Æ‰øùÊúÄÁªàÂÅúÁïôÂú®ÁõÆÊ†áËßíÂ∫¶ÔºåÈÅøÂÖçÊµÆÁÇπËØØÂ∑Æ\r\n\t\t\t\t\t\tthis.drawWheel(); // ÊúÄÂêéÈáçÁªò‰∏ÄÊ¨°\r\n\t\t\t\t\t\tif (onFinish) onFinish(); // üéØ Ë∞ÉÁî®ÂõûË∞ÉÔºåÊòæÁ§∫ÁªìÊûú\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tstep();\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tpadding: 20px;\r\n\t}\r\n\r\n\t.wheel-wrapper {\r\n\t\tposition: relative;\r\n\t\tmargin-bottom: 40px;\r\n\t}\r\n\r\n\t.wheel-canvas {\r\n\t\tborder: 3px solid #ddd;\r\n\t\tborder-radius: 50%;\r\n\t\tbox-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.pointer {\r\n\t\tposition: absolute;\r\n\t\ttop: -10px;\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%);\r\n\t\twidth: 0;\r\n\t\theight: 0;\r\n\t\tborder-left: 10px solid transparent;\r\n\t\tborder-right: 10px solid transparent;\r\n\t\tborder-top: 20px solid #ff4757;\r\n\t\tz-index: 10;\r\n\t}\r\n\r\n\t.spin-button {\r\n\t\tbackground-color: #ff6b6b;\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tpadding: 12px 24px;\r\n\t\tfont-size: 16px;\r\n\t\tborder-radius: 25px;\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\r\n\t.spin-button[disabled] {\r\n\t\tbackground-color: #ccc;\r\n\t}\r\n\r\n\t.result {\r\n\t\tfont-size: 18px;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #333;\r\n\t\tmargin-top: 20px;\r\n\t}\r\n</style>","import MiniProgramPage from 'D:/workspace/wheel/wheel/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}